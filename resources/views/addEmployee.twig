    {% extends "admindashboard.twig" %}

{%  block content %}


    <div class="card">
<div class="alert alert-success animated jello" id="alertfore" style="display:none;">
    <b>Employee was successfully added!</b>
</div>

<div class="alert alert-warning animated jello" id="alertforerror" style="display:none;">
    <b>Something went wrong</b>
</div>
<h5 class="card-header">Register New Employee<img style="display:none;height:30px;width:30px;" src="{{base_url()}}/img/lg.rotating-balls-spinner.gif"
        id='gif'>
 </h5>
        <div class="card-body">

<form id="eform" action="{{ path_for('post.employee') }}" method="POST">
<div class="form-group ">
<label for="email">Email</label>
<input type="email" name="email" id="email" class="{{errors.email ? 'has-error ': '' }}
 form-control"  id="email" placeholder="you@domain.com" value={{ old.email }} >

{%  if errors.email %}
<span class="help-block has-error-p">{{ errors.email | first}}</span>
{% endif %}

</div>

<div class="form-group">
    <label for="name">Given Name</label>
    <input type="text" name="firstname" id="givenname" class="{{errors.firstname ? 'has-error ': '' }} form-control" id="name"
    placeholder="John" value={{ old.firstname }} >
{% if errors.firstname %}
<span class="help-block has-error-p">{{ errors.firstname | first}}</span>
{% endif %}
</div>

<div class="form-group">
    <label for="name">Family Name</label>
    <input type="texfirst" name="lastname" id="familyname" class="{{errors.lastname ? 'has-error ': '' }} form-control" id="name"
    placeholder="Doe" value={{ old.lastname }} >
{% if errors.lastname %}
<span class="help-block has-error-p">{{ errors.lastname | first}}</span>
{% endif %}
</div>

<div class="form-group">
    <label for="name">Date of Birth</label>
    <input type="date" name="dateOfBirth"  class="{{errors.dateOfBirth ? 'has-error ': '' }} form-control"
        id="dateOfBirth">
    {% if errors.dateOfBirth %}
    <span class="help-block has-error-p">{{ errors.dateOfBirth | first}}</span>
    {% endif %}
</div>
<!-- deparment -->
<div class="form-group">
    <label for="name">Department</label>
<select name="department" id="department" class="{{errors.department ? 'has-error ': '' }} form-control">
{% for department in auth.getDepartments%}

<option value="{{department.department}}">{{department.department}}</option>

{% endfor %}
</select>
    {% if errors.department %}
<span class="help-block has-error-p">{{ errors.department | first}}</span>
{% endif %}
</div>
<!-- gender -->
<div class="form-group">
    <label for="name">Gender</label>
    <select name="gender" id="gender" class="{{errors.gender ? 'has-error ': '' }} form-control">
        <option selected>
            --GENDER--
        </option>
        <option value="male">Male</option>
        <option value="female">Female</option>
    </select>
    {% if errors.gender %}
    <span class="help-block has-error-p">{{ errors.gender | first}}</span>
    {% endif %}
</div>

<button type="submit" class="btn btn-success" id="imageUploadButton">Signup</button>

</form>
           </div>
    </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.6/dist/loadingoverlay.min.js" type="text/javascript"></script>
      
    <script>
$(document).ready(function(){


      $('#eform').on('submit', function (e) {
        e.preventDefault();
        // console.log('in progress');

        var givenname = $('#givenname').val();
        var familyname = $('#familyname').val();
        var email = $('#email').val();
        var department = $('#department').val();
        var gender = $('#gender').val();
        var dateOfBirth = $('#dateOfBirth').val();
        const url = $('#eform').attr('action');
                        document.getElementById('alertforerror').style.display = 'none';
                        document.getElementById('alertfore').style.display = 'none';

        $.ajax({
            method: "POST",
            data: {
                dateOfBirth:dateOfBirth,
                email: email,
                givenname: givenname,
                familyname: familyname,
                department: department,
                gender: gender
            },
            url: url,
          
        beforeSend: function () {
           
        $("#eform").LoadingOverlay("show");

        },
        complete: function () {

         $("#eform").LoadingOverlay("hide");

     
        },
        success: function (data, textStatus, jqXHR) {
        
$("#eform").LoadingOverlay("hide");

  if(data == 'success'){
                    
                    document.getElementById('alertfore').innerHTML = data
                    document.getElementById('alertfore').style.display = 'block';
                    console.log(data);
                    console.log(textStatus);
                    setInterval(close,6000);
                $('#eform').LoadingOverlay('hide');

                
                }else if(data == 'failed'){
               
                    document.getElementById('alertforerror').innerHTML = data
                    document.getElementById('alertforerror').style.display = 'block';
                    console.log(data);
                    console.log(jqXHR);
                    setInterval(close,6000);
                $('#eform').LoadingOverlay('hide');

    
                
                }else if(data == 'Failed to send Email'){
          
                    document.getElementById('alertforerror').innerHTML = data
                    document.getElementById('alertforerror').style.display = 'block';
                    console.log(data);
                    console.log(jqXHR);
                    setInterval(close,7000)
                $('#eform').LoadingOverlay('hide');

    
                }else{
                    
                   document.getElementById('alertforerror').innerHTML = Object.values(JSON.parse(data))
                        document.getElementById('alertforerror').style.display = 'block';
                        setInterval(closeE,000)
                    console.log(textStatus);
                    console.log(jqXHR);
                $('#eform').LoadingOverlay('hide');
               }

                function close(){
                        document.getElementById('alertforerror').style.display = 'none';
                        document.getElementById('alertfore').style.display = 'none';

                }

                    

        },
        error: function (jqXHR, textStatus, errorThrown) {
           console.log(errorThrown);
                console.log(jqXHR);
                console.log(textStatus);
                
                document.getElementById("alertforerror").innerHTML = textStatus;
                document.getElementById("alertforerror").style.display = "none";
                setInterval(closeE,6000)
                $('#eform').LoadingOverlay('hide');

                
        function closeE(){
                        document.getElementById('alertforerror').style.display = 'none';

                }

        }
            });

});

});
    </script>

{% endblock %}
